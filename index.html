<script type="module">
 import { html, render, useState } from 'https://unpkg.com/htm/preact/standalone.module.js'

 function WordStack(props) {
   return html`<ul>${props.words.map((word) => html`<li>${word}</li>`)}</ul>`
 }

 function WordInput(props) {
   const [word, setWord] = useState("")

   function onSubmit(e) {
     e.preventDefault()
     props.onSubmit(word)
   }

   return html`
     <form onSubmit=${onSubmit}>
       <input type="text" value=${word} onInput=${(e) => setWord(e.target.value)}/>
     </form>
   `
 }


 function App(props) {
   const [words, setWords] = useState([])

   function streamSimilarWords(word) {
     let socket = new WebSocket("ws://localhost:8765")

     socket.onmessage = (event) => {
       console.log("Words:", words)
       console.log(`[message] Data received from server: ${event.data}`)
       const newWords = words.concat([event.data])
       // if (newWords.length > 5) {
       //   newWords.shift()
       // }
       console.log("Setting words", newWords)
       setWords(words => words.concat([event.data]))
     }

     socket.onopen = () => socket.send(word)
   }

   return html`
     <${WordStack} words=${words}/>
     <${WordInput} onSubmit=${streamSimilarWords}/>
   `
 }

 render(html`<${App} />`, document.body)

</script>
